# Device Module

Device 是 openiot-server 的核心模块，主要完成和由机器人采集到的设备数据进行交互的服务。openiot 项目组尽力提供一个用户有好的设备监控治理云服务。

## 需求分析

由于工厂拥有各种各样的设备，包括气体浓度检查，温度检查，容量检查，分贝检查等，如果去定制化得实现每一种设备是不经济的，也是不现实的。
为了项目的向前拓展性，openiot 软件开发组对其进行了针对性的设计，使用一个可变参数字段 external 来储存这些数据，达成对于所有工厂设备的抽象。该字段的格式为 JSON，能够弹性地完成对于监控指标地储存。

我们的参数需要设计成表单的形式。
```toml
DeviceName = <Name>; DeviceType = <Type>;
...
| Key | Value | TimeStamp |
| --- | ----- | --------- |
```
分为表头和表体，表头为该设备信息的介绍，储存在 MYSQL 中。表体为可变参数的字段，使用 JSON 格式储存在 MongoDB 中。
数据库中的每一张表和 MongoDB 中的每一个字段就是一个表单。
这个表单将会在 `/device/:id/form` 下展示。数据分别是通过 `/api/v1/device/:id` 和 `/api/v1/device/:id/record` 来请求的。

自然我们也需要一个设备清单，`/device/list` 中将会使用一个表格的形式展示设备的基本信息和上次数据更新时间，并使用颜色表示设备状。大概就是红黄绿吧，作为数据条的底色。

```toml
| Name | Update_at | <UI button>: [Detail] [Address] |
```

FluentUI 用来搞这种面板是真的好看但是取决于后期的开发进度。

### Router

```http request
/device/list -> GET /api/v1/devices
/device/:id/form -> GET /api/v1/device/:id
                 -> GET /api/v1/device/:id/record
```

### 展示格式

除了列表的形式，我们还需要使用 line graph 进行报警信息统计的展示。可以展示的线状图有总体报警次数的历史曲线汇总，按月度报警次数进行汇总，这个直接存在 redis 里面即可，每次报警 count++。

> 精度不够？持久化问题？

这张表格呈现在面板首页。

然后既然设备有分类的情况下，我们可以选择统计不同类型设备的报警次数，并进行排名或者是用饼状图的形式进行呈现。

再加上地图组件后设备也就有四个组件，分别是
- 条状图呈现报警次数随时间的变化
- 饼状图呈现不同类型设备的报警占比
- 地图组件呈现设备地点
- 设备列表

## 后续功能

- OCR 识别



